@model ResetPasswordViewModel
@{
	ViewData["Title"] = "Reset Password";
}

<div class="mx-auto py-5">
	<div class="row justify-content-center">
		<div class="col-md-8 col-lg-6">
			<!-- Header -->
			<div class="text-center mb-5">
				<div class="mb-3">
					<i class="bi bi-key display-1 text-primary"></i>
				</div>
				<h1 class="fw-bold text-primary">Reset Password</h1>
				<p class="text-muted">Enter your email and new password</p>
			</div>

			<!-- Password Reset Form -->
			<div class="card border-0 shadow-sm rounded-3">
				<div class="card-body p-4 p-md-5">
					<!-- Validation Summary -->
					<div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-2 mb-4" role="alert"></div>

					<form method="post" id="resetForm" asp-action="ResetPassword" asp-controller="Account">
						<input type="hidden" asp-for="Token" />
						<input type="hidden" asp-for="UserId" />
						<!-- New Password -->
						<div class="mb-4">
							<label asp-for="Password" class="form-label fw-medium">
								<i class="bi bi-lock me-1"></i> New Password
							</label>
							<div class="input-group">
								<input asp-for="Password" type="password" class="form-control form-control-lg rounded-2"
									   placeholder="Enter new password" id="newPassword">
								<button class="btn btn-outline-secondary" type="button" id="togglePassword">
									<i class="bi bi-eye"></i>
								</button>
							</div>
							<span asp-validation-for="Password" class="text-danger small"></span>
						</div>

						<!-- Confirm Password -->
						<div class="mb-4">
							<label asp-for="ConfirmPassword" class="form-label fw-medium">
								<i class="bi bi-lock-fill me-1"></i> Confirm Password
							</label>
							<div class="input-group">
								<input asp-for="ConfirmPassword" type="password" class="form-control form-control-lg rounded-2"
									   placeholder="Confirm new password" id="confirmPassword">
								<button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
									<i class="bi bi-eye"></i>
								</button>
							</div>
							<span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
							<div id="passwordMatch" class="mt-2 small" style="display: none;">
								<i class="bi me-1"></i> <span></span>
							</div>
						</div>

						<!-- Form Actions -->
						<div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-5 pt-3 border-top">
							<a asp-controller="Account" asp-action="Login"
							   class="btn btn-outline-secondary px-3 py-2 rounded-2 fw-medium">
								<i class="bi bi-arrow-left me-2"></i> Back to Login
							</a>
							<button type="reset" class="btn btn-outline-warning px-3 py-2 rounded-2 fw-medium">
								<i class="bi bi-arrow-clockwise me-2"></i> Clear Form
							</button>
							<button type="submit" class="btn btn-primary px-3 py-2 rounded-2 fw-medium">
								<i class="bi bi-check-circle me-2"></i> Reset Password
							</button>

						</div>
					</form>
				</div>
			</div>

			<!-- Password Requirements -->
			<div class="card border-0 shadow-sm rounded-3 mt-4">
				<div class="card-body p-4">
					<h5 class="fw-bold mb-3">
						<i class="bi bi-shield-check text-primary me-2"></i> Password Requirements
					</h5>
					<ul class="list-unstyled mb-0">
						<li class="mb-2">
							<i class="bi bi-check-circle-fill text-success me-2"></i>
							<small>Minimum 6 characters</small>
						</li>
						<li class="mb-2">
							<i class="bi bi-check-circle-fill text-success me-2"></i>
							<small>At least one uppercase letter</small>
						</li>
						<li class="mb-2">
							<i class="bi bi-check-circle-fill text-success me-2"></i>
							<small>At least one lowercase letter</small>
						</li>
						<li>
							<i class="bi bi-check-circle-fill text-success me-2"></i>
							<small>At least one number</small>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<style>
	/* Custom styling */
	.card {
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

		.card:hover {
			transform: translateY(-3px);
			box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
		}

	.form-control {
		border: 1px solid #dee2e6;
		padding: 0.75rem 1rem;
		transition: all 0.2s ease;
	}

		.form-control:focus {
			border-color: #0d6efd;
			box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
		}

	.form-label {
		font-size: 0.9rem;
		color: #495057;
		margin-bottom: 0.5rem;
	}

	.btn-primary {
		background-color: #0d6efd;
		border-color: #0d6efd;
		transition: all 0.2s ease;
	}

		.btn-primary:hover {
			background-color: #0b5ed7;
			border-color: #0a58ca;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(13, 110, 253, 0.25);
		}

	.btn-outline-warning:hover {
		background-color: #ffc107;
		color: #000;
		transform: translateY(-2px);
		box-shadow: 0 4px 12px rgba(255, 193, 7, 0.25);
	}

	.btn-outline-secondary:hover {
		background-color: #6c757d;
		color: white;
		transform: translateY(-2px);
	}

	/* Password match indicator */
	#passwordMatch.valid {
		color: #198754;
	}

	#passwordMatch.invalid {
		color: #dc3545;
	}

	/* Alert styling */
	.alert {
		border: none;
	}

	/* Responsive adjustments */
	@@media (max-width: 768px) {
		.card-body {
			padding: 1.5rem !important;
		}

		.display-1 {
			font-size: 3.5rem;
		}
	}
</style>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />

	<script>
		document.addEventListener('DOMContentLoaded', function() {
			// Password visibility toggle
			function setupPasswordToggle(buttonId, inputId) {
				const toggleBtn = document.getElementById(buttonId);
				const passwordInput = document.getElementById(inputId);

				if (toggleBtn && passwordInput) {
					toggleBtn.addEventListener('click', function() {
						const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
						passwordInput.setAttribute('type', type);
						this.innerHTML = type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
					});
				}
			}

			// Setup toggles
			setupPasswordToggle('togglePassword', 'newPassword');
			setupPasswordToggle('toggleConfirmPassword', 'confirmPassword');

			// Password match validation
			const newPasswordInput = document.getElementById('newPassword');
			const confirmPasswordInput = document.getElementById('confirmPassword');
			const passwordMatchDiv = document.getElementById('passwordMatch');

			if (newPasswordInput && confirmPasswordInput && passwordMatchDiv) {
				function checkPasswordMatch() {
					const password = newPasswordInput.value;
					const confirmPassword = confirmPasswordInput.value;

					if (password && confirmPassword) {
						const passwordsMatch = password === confirmPassword;
						passwordMatchDiv.style.display = 'block';

						if (passwordsMatch) {
							passwordMatchDiv.className = 'mt-2 small valid';
							passwordMatchDiv.innerHTML = '<i class="bi bi-check-circle-fill me-1"></i> Passwords match';
						} else {
							passwordMatchDiv.className = 'mt-2 small invalid';
							passwordMatchDiv.innerHTML = '<i class="bi bi-x-circle-fill me-1"></i> Passwords do not match';
						}
					} else {
						passwordMatchDiv.style.display = 'none';
					}
				}

				newPasswordInput.addEventListener('input', checkPasswordMatch);
				confirmPasswordInput.addEventListener('input', checkPasswordMatch);

				// Initial check
				checkPasswordMatch();
			}

			// Enhanced reset button functionality
			const resetBtn = document.querySelector('button[type="reset"]');
			const form = document.getElementById('resetForm');

			if (resetBtn && form) {
				resetBtn.addEventListener('click', function() {
					// Clear all inputs
					form.reset();

					// Hide password match indicator
					if (passwordMatchDiv) {
						passwordMatchDiv.style.display = 'none';
					}

					// Reset password visibility toggles
					document.querySelectorAll('.btn-outline-secondary i').forEach(icon => {
						icon.className = 'bi bi-eye';
					});

					// Reset input types to password
					document.querySelectorAll('input[type="text"][id*="Password"]').forEach(input => {
						input.setAttribute('type', 'password');
					});

					// Clear validation styling
					document.querySelectorAll('.form-control').forEach(input => {
						input.classList.remove('is-invalid', 'is-valid');
					});

					// Clear validation messages
					document.querySelectorAll('.field-validation-error').forEach(span => {
						span.textContent = '';
					});

					// Give visual feedback
					const originalText = this.innerHTML;
					this.innerHTML = '<i class="bi bi-check me-2"></i> Cleared';
					this.classList.remove('btn-outline-warning');
					this.classList.add('btn-success');

					setTimeout(() => {
						this.innerHTML = originalText;
						this.classList.remove('btn-success');
						this.classList.add('btn-outline-warning');
					}, 1500);
				});
			}
		});
	</script>
}