@model ChangePasswordViewModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">


            <!-- Header -->
            <div class="text-center mb-5">
                <div class="mb-3">
                    <i class="bi bi-shield-lock display-1 text-primary"></i>
                </div>
                <h1 class="fw-bold text-primary">Change Password</h1>
                <p class="text-muted">Update your password to keep your account secure</p>
            </div>
           
            <!-- Password Form -->
            <div class="card border-0 shadow-sm rounded-3">
                <div class="card-body p-4 p-md-5">
                    <form asp-action="ChangePassword" asp-controller="Account" method="post" id="passwordForm">
                        <input type="hidden" asp-for="UserId" />
                        <!-- Current Password -->
                        <div class="mb-4">
                            <label asp-for="CurrentPassword" class="form-label fw-medium">
                                <i class="bi bi-key me-1"></i> Current Password
                            </label>
                            <div class="input-group">
                                <input asp-for="CurrentPassword" class="form-control form-control-lg rounded-2"
                                       placeholder="Enter your current password" type="password" id="currentPassword">
                                <button class="btn btn-outline-secondary" type="button" id="toggleCurrentPassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="CurrentPassword" class="text-danger small"></span>
                        </div>

                        <!-- New Password -->
                        <div class="mb-4">
                            <label asp-for="NewPassword" class="form-label fw-medium">
                                <i class="bi bi-lock me-1"></i> New Password
                            </label>
                            <div class="input-group">
                                <input asp-for="NewPassword" class="form-control form-control-lg rounded-2"
                                       placeholder="Enter your new password" type="password" id="newPassword">
                                <button class="btn btn-outline-secondary" type="button" id="toggleNewPassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <div class="password-requirements mt-2">
                                <small class="text-muted">Password must contain:</small>
                                <ul class="list-unstyled mb-0 small">
                                    <li id="lengthReq"><i class="bi me-1"></i> At least 6 characters</li>
                                    <li id="uppercaseReq"><i class="bi me-1"></i> One uppercase letter</li>
                                    <li id="lowercaseReq"><i class="bi me-1"></i> One lowercase letter</li>
                                    <li id="numberReq"><i class="bi me-1"></i> One number</li>
                                </ul>
                            </div>
                            <span asp-validation-for="NewPassword" class="text-danger small"></span>
                        </div>

                        <!-- Confirm Password -->
                        <div class="mb-4">
                            <label asp-for="ConfirmPassword" class="form-label fw-medium">
                                <i class="bi bi-lock-fill me-1"></i> Confirm New Password
                            </label>
                            <div class="input-group">
                                <input asp-for="ConfirmPassword" class="form-control form-control-lg rounded-2"
                                       placeholder="Confirm your new password" type="password" id="confirmPassword">
                                <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger small"></span>
                            <div id="passwordMatch" class="mt-2 small" style="display: none;">
                                <i class="bi me-1"></i> <span></span>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-5 pt-3 border-top">
                            <div class="mb-3 mb-md-0">
                                <a asp-controller="Account" asp-action="Profile"
                                   class="btn btn-outline-secondary px-4 py-2 rounded-2 fw-medium">
                                    <i class="bi bi-arrow-left me-2"></i> Back to Profile
                                </a>
                            </div>
                            <div class="d-flex gap-3">
                                <button type="reset" class="btn btn-outline-primary px-4 py-2 rounded-2 fw-medium">
                                    <i class="bi bi-arrow-clockwise me-2"></i> Clear
                                </button>
                                <button type="submit" class="btn btn-primary px-4 py-2 rounded-2 fw-medium">
                                    <i class="bi bi-check-circle me-2"></i> Update Password
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Security Tips -->
            <div class="card border-0 shadow-sm rounded-3 mt-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-3">
                        <i class="bi bi-shield-check text-primary me-2"></i> Security Tips
                    </h5>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <small>Use a unique password you don't use elsewhere</small>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <small>Avoid personal information like birthdays or names</small>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <small>Consider using a password manager</small>
                        </li>
                        <li>
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <small>Change your password regularly for better security</small>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    /* Custom styling */
    .card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
        }

    .form-control {
        border: 1px solid #dee2e6;
        padding: 0.75rem 1rem;
        transition: all 0.2s ease;
    }

        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
        }

    .form-label {
        font-size: 0.9rem;
        color: #495057;
        margin-bottom: 0.5rem;
    }

    .btn-primary {
        background-color: #0d6efd;
        border-color: #0d6efd;
        transition: all 0.2s ease;
    }

        .btn-primary:hover {
            background-color: #0b5ed7;
            border-color: #0a58ca;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.25);
        }

    .btn-outline-primary:hover {
        background-color: #0d6efd;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(13, 110, 253, 0.25);
    }

    /* Password requirement styling */
    .password-requirements li {
        margin-bottom: 0.25rem;
    }

        .password-requirements li.valid {
            color: #198754;
        }

            .password-requirements li.valid i {
                content: "\F26A"; /* bi-check-circle */
                font-family: "bootstrap-icons";
            }

        .password-requirements li.invalid {
            color: #dc3545;
        }

            .password-requirements li.invalid i {
                content: "\F282"; /* bi-x-circle */
                font-family: "bootstrap-icons";
            }

    /* Password match indicator */
    #passwordMatch.valid {
        color: #198754;
    }

    #passwordMatch.invalid {
        color: #dc3545;
    }

    /* Responsive adjustments */
    @@media (max-width: 768px) {
        .card-body {
            padding: 1.5rem !important;
        }

        .display-1 {
            font-size: 3.5rem;
        }
    }
</style>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Password visibility toggle
            function setupPasswordToggle(buttonId, inputId) {
                const toggleBtn = document.getElementById(buttonId);
                const passwordInput = document.getElementById(inputId);

                toggleBtn.addEventListener('click', function() {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    this.innerHTML = type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
                });
            }

            // Setup toggles
            setupPasswordToggle('toggleCurrentPassword', 'currentPassword');
            setupPasswordToggle('toggleNewPassword', 'newPassword');
            setupPasswordToggle('toggleConfirmPassword', 'confirmPassword');

            // Password validation
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const passwordMatchDiv = document.getElementById('passwordMatch');

            function validatePassword() {
                const password = newPasswordInput.value;

                // Check password requirements
                const hasLength = password.length >= 6;
                const hasUppercase = /[A-Z]/.test(password);
                const hasLowercase = /[a-z]/.test(password);
                const hasNumber = /\d/.test(password);

                // Update requirement indicators
                updateRequirement('lengthReq', hasLength);
                updateRequirement('uppercaseReq', hasUppercase);
                updateRequirement('lowercaseReq', hasLowercase);
                updateRequirement('numberReq', hasNumber);

                // Check password match
                const confirmPassword = confirmPasswordInput.value;
                if (password && confirmPassword) {
                    const passwordsMatch = password === confirmPassword;
                    passwordMatchDiv.style.display = 'block';

                    if (passwordsMatch) {
                        passwordMatchDiv.className = 'mt-2 small valid';
                        passwordMatchDiv.innerHTML = '<i class="bi bi-check-circle-fill me-1"></i> Passwords match';
                    } else {
                        passwordMatchDiv.className = 'mt-2 small invalid';
                        passwordMatchDiv.innerHTML = '<i class="bi bi-x-circle-fill me-1"></i> Passwords do not match';
                    }
                } else {
                    passwordMatchDiv.style.display = 'none';
                }
            }

            function updateRequirement(elementId, isValid) {
                const element = document.getElementById(elementId);
                element.className = isValid ? 'valid' : 'invalid';
                const icon = isValid ? 'bi-check-circle-fill' : 'bi-x-circle-fill';
                element.innerHTML = `<i class="bi ${icon} me-1"></i>${element.textContent.replace(/^.*?i>/, '')}`;
            }

            // Add event listeners
            newPasswordInput.addEventListener('input', validatePassword);
            confirmPasswordInput.addEventListener('input', validatePassword);

            // Clear button functionality
            document.querySelector('button[type="reset"]').addEventListener('click', function() {
                // Clear validation indicators
                ['lengthReq', 'uppercaseReq', 'lowercaseReq', 'numberReq'].forEach(id => {
                    const element = document.getElementById(id);
                    element.className = '';
                    element.innerHTML = `<i class="bi me-1"></i>${element.textContent.replace(/^.*?i>/, '')}`;
                });

                passwordMatchDiv.style.display = 'none';
                passwordMatchDiv.className = 'mt-2 small';
                passwordMatchDiv.innerHTML = '';

                // Reset eye icons
                document.querySelectorAll('.btn-outline-secondary i').forEach(icon => {
                    icon.className = 'bi bi-eye';
                });

                // Reset input types
                document.querySelectorAll('input[type="text"][id*="Password"]').forEach(input => {
                    input.setAttribute('type', 'password');
                });
            });

            // Initial validation
            validatePassword();
        });
    </script>
}